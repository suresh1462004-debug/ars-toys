<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARS Toys ‚Äì Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --dark:#1A1A2E; --darker:#0F0F1A; --yellow:#FFD600; --blue:#1A6FFF;
  --green:#00C16A; --red:#FF3A3A; --orange:#FF7B00; --purple:#9B5DE5;
  --bg:#F4F6FA; --white:#fff; --border:#E5E7EB; --text:#1A1A2E; --muted:#6B7280;
  --sidebar:260px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);}

/* ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ */
#loginPage{display:flex;min-height:100vh;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--dark) 0%,#2D1B69 60%,#1A2F6B 100%);}
.login-card{background:var(--white);border-radius:28px;padding:48px 44px;width:100%;max-width:440px;box-shadow:0 24px 80px rgba(0,0,0,.35);animation:popIn .4s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{transform:scale(.85);opacity:0;}to{transform:scale(1);opacity:1;}}
.login-logo{text-align:center;margin-bottom:32px;}
.login-icon{width:72px;height:72px;background:var(--yellow);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 14px;transform:rotate(-5deg);box-shadow:4px 4px 0 var(--orange);}
.login-title{font-family:'Fredoka One',cursive;font-size:28px;color:var(--dark);}
.login-sub{color:var(--muted);font-size:14px;font-weight:600;margin-top:4px;}
.form-group{margin-bottom:18px;}
.form-group label{display:block;font-weight:800;font-size:13px;margin-bottom:7px;color:var(--dark);}
.form-group input{width:100%;padding:13px 16px;border-radius:14px;border:2.5px solid var(--border);font-family:'Nunito',sans-serif;font-weight:700;font-size:15px;outline:none;transition:border-color .2s;}
.form-group input:focus{border-color:var(--blue);}
.login-btn{width:100%;padding:15px;background:var(--dark);color:var(--yellow);border:none;border-radius:14px;font-family:'Nunito',sans-serif;font-weight:900;font-size:17px;cursor:pointer;transition:all .2s;box-shadow:0 4px 0 #0a0a18;margin-top:8px;}
.login-btn:hover{background:#2a2a4e;transform:translateY(-2px);box-shadow:0 6px 0 #0a0a18;}
.login-err{color:var(--red);font-size:13px;font-weight:800;text-align:center;margin-top:12px;display:none;}
.login-hint{text-align:center;margin-top:18px;color:var(--muted);font-size:13px;font-weight:700;}

/* ‚îÄ‚îÄ ADMIN LAYOUT ‚îÄ‚îÄ */
#adminApp{display:none;min-height:100vh;}
.admin-wrap{display:flex;min-height:100vh;}

/* SIDEBAR */
.sidebar{width:var(--sidebar);background:var(--dark);display:flex;flex-direction:column;position:fixed;top:0;left:0;height:100vh;z-index:200;overflow-y:auto;}
.sb-logo{padding:24px 22px 20px;border-bottom:1px solid rgba(255,255,255,.08);}
.sb-logo-icon{width:44px;height:44px;background:var(--yellow);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:10px;transform:rotate(-4deg);}
.sb-logo-text{font-family:'Fredoka One',cursive;font-size:22px;color:var(--white);}
.sb-logo-text span{color:var(--yellow);}
.sb-role{font-size:11px;color:rgba(255,255,255,.4);font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
.sb-nav{padding:18px 12px;flex:1;}
.sb-section{font-size:10px;font-weight:900;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.3);padding:8px 12px 6px;margin-top:8px;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 14px;border-radius:14px;color:rgba(255,255,255,.6);text-decoration:none;font-weight:800;font-size:14px;cursor:pointer;transition:all .2s;margin-bottom:3px;border:none;background:none;width:100%;text-align:left;font-family:'Nunito',sans-serif;}
.nav-item:hover{background:rgba(255,255,255,.08);color:white;}
.nav-item.active{background:var(--yellow);color:var(--dark);}
.nav-item .nav-icon{font-size:18px;width:24px;text-align:center;}
.nav-item .nav-badge{margin-left:auto;background:var(--red);color:white;border-radius:50px;padding:2px 8px;font-size:11px;font-weight:900;}
.sb-footer{padding:16px 14px;border-top:1px solid rgba(255,255,255,.08);}
.logout-btn{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;color:rgba(255,255,255,.5);cursor:pointer;transition:all .2s;border:none;background:none;font-family:'Nunito',sans-serif;font-weight:800;font-size:13px;width:100%;}
.logout-btn:hover{background:rgba(255,0,0,.15);color:var(--red);}

/* MAIN CONTENT */
.main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;}
.topbar{background:var(--white);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;}
.topbar-title{font-family:'Fredoka One',cursive;font-size:24px;color:var(--dark);}
.topbar-right{display:flex;align-items:center;gap:14px;}
.topbar-admin{background:var(--bg);padding:8px 16px;border-radius:50px;font-weight:800;font-size:13px;display:flex;align-items:center;gap:8px;}
.view-shop-btn{background:var(--yellow);color:var(--dark);padding:9px 18px;border-radius:50px;font-weight:800;font-size:13px;text-decoration:none;transition:all .2s;box-shadow:2px 2px 0 var(--orange);}
.view-shop-btn:hover{transform:translateY(-1px);}
.page-content{padding:32px;flex:1;}

/* STATS CARDS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;margin-bottom:32px;}
.stat-card{background:var(--white);border-radius:20px;padding:22px;box-shadow:0 2px 12px rgba(0,0,0,.06);display:flex;align-items:center;gap:16px;border:1px solid var(--border);}
.stat-icon{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
.stat-value{font-family:'Fredoka One',cursive;font-size:28px;color:var(--dark);line-height:1;}
.stat-label{font-size:13px;color:var(--muted);font-weight:700;margin-top:2px;}

/* PANEL CARD */
.panel{background:var(--white);border-radius:20px;padding:26px;box-shadow:0 2px 12px rgba(0,0,0,.06);border:1px solid var(--border);margin-bottom:24px;}
.panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;flex-wrap:gap;}
.panel-title{font-family:'Fredoka One',cursive;font-size:20px;color:var(--dark);}
.btn{padding:9px 20px;border-radius:12px;border:none;font-family:'Nunito',sans-serif;font-weight:800;font-size:13px;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:7px;}
.btn-primary{background:var(--dark);color:var(--yellow);}
.btn-primary:hover{background:#2a2a4e;}
.btn-success{background:var(--green);color:white;}
.btn-success:hover{background:#00a85a;}
.btn-danger{background:var(--red);color:white;}
.btn-danger:hover{background:#cc0000;}
.btn-warning{background:var(--orange);color:white;}
.btn-sm{padding:6px 14px;font-size:12px;border-radius:9px;}

/* TABLE */
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th{background:var(--bg);padding:12px 16px;text-align:left;font-size:12px;font-weight:900;text-transform:uppercase;letter-spacing:1px;color:var(--muted);border-bottom:2px solid var(--border);}
td{padding:14px 16px;border-bottom:1px solid var(--border);font-size:14px;font-weight:600;}
tr:hover td{background:#FAFAFA;}
.td-img{width:52px;height:52px;border-radius:12px;object-fit:cover;background:#f0f0f0;display:flex;align-items:center;justify-content:center;font-size:24px;overflow:hidden;}
.td-img img{width:100%;height:100%;object-fit:cover;}
.status-badge{padding:4px 12px;border-radius:50px;font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:.5px;}
.status-pending{background:#FEF3C7;color:#D97706;}
.status-confirmed{background:#DBEAFE;color:#2563EB;}
.status-shipped{background:#EDE9FE;color:#7C3AED;}
.status-delivered{background:#D1FAE5;color:#059669;}
.status-cancelled{background:#FEE2E2;color:#DC2626;}

/* SEARCH/FILTER BAR */
.toolbar{display:flex;align-items:center;gap:12px;margin-bottom:20px;flex-wrap:wrap;}
.toolbar input,.toolbar select{padding:9px 16px;border-radius:12px;border:2px solid var(--border);font-family:'Nunito',sans-serif;font-weight:700;font-size:13px;outline:none;transition:border-color .2s;}
.toolbar input:focus,.toolbar select:focus{border-color:var(--blue);}

/* MODAL */
.m-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:600;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.m-overlay.open{display:flex;}
.m-box{background:var(--white);border-radius:24px;width:90%;max-width:580px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;animation:popIn .3s cubic-bezier(.34,1.56,.64,1);}
.m-hd{background:var(--dark);padding:20px 26px;display:flex;align-items:center;justify-content:space-between;}
.m-title{font-family:'Fredoka One',cursive;font-size:22px;color:var(--yellow);}
.m-close{background:rgba(255,255,255,.15);border:none;color:white;width:34px;height:34px;border-radius:50%;font-size:17px;cursor:pointer;}
.m-close:hover{background:var(--red);}
.m-body{padding:26px;overflow-y:auto;flex:1;}
.m-fg{margin-bottom:16px;}
.m-fg label{display:block;font-weight:800;font-size:13px;margin-bottom:6px;}
.m-fg input,.m-fg select,.m-fg textarea{width:100%;padding:11px 14px;border-radius:12px;border:2px solid var(--border);font-family:'Nunito',sans-serif;font-weight:700;font-size:14px;outline:none;transition:border-color .2s;}
.m-fg input:focus,.m-fg select:focus,.m-fg textarea:focus{border-color:var(--blue);}
.m-fg textarea{resize:vertical;min-height:80px;}
.m-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.img-preview{width:100%;height:180px;border-radius:14px;object-fit:cover;border:2px solid var(--border);margin-top:10px;display:none;}
.m-ft{padding:18px 26px;border-top:1px solid var(--border);background:var(--bg);display:flex;gap:12px;justify-content:flex-end;}

/* PAGES */
.page{display:none;}
.page.active{display:block;}

/* STAR DISPLAY */
.star-display{color:var(--yellow);font-size:14px;}

/* EMPTY */
.empty-state{text-align:center;padding:60px 20px;color:var(--muted);}
.empty-state .ei{font-size:56px;margin-bottom:14px;}

/* TOAST */
.admin-toast{position:fixed;bottom:30px;right:30px;background:var(--dark);color:var(--yellow);padding:13px 22px;border-radius:50px;font-weight:900;font-size:14px;z-index:9999;transform:translateY(20px);opacity:0;transition:all .3s;box-shadow:0 8px 24px rgba(0,0,0,.3);}
.admin-toast.show{transform:translateY(0);opacity:1;}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-card">
    <div class="login-logo">
      <div class="login-icon">üß∏</div>
      <div class="login-title">ARS Toys Admin</div>
      <div class="login-sub">Sign in to manage your toy shop</div>
    </div>
    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="loginEmail" placeholder="Enter your email">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPass" placeholder="Enter your password" onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <button class="login-btn" onclick="doLogin()">üîê Sign In to Admin Panel</button>
    <div class="login-err" id="loginErr">Invalid email or password!</div>
  </div>
</div>

<!-- ADMIN APP -->
<div id="adminApp">
  <div class="admin-wrap">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sb-logo">
        <div class="sb-logo-icon">üß∏</div>
        <div class="sb-logo-text">A R S <span>TOYS</span></div>
        <div class="sb-role">Admin Panel</div>
      </div>
      <nav class="sb-nav">
        <div class="sb-section">Main</div>
        <button class="nav-item active" onclick="showPage('dashboard',this)"><span class="nav-icon">üìä</span> Dashboard</button>
        <div class="sb-section">Manage</div>
        <button class="nav-item" onclick="showPage('products',this)"><span class="nav-icon">üß∏</span> Products</button>
        <button class="nav-item" onclick="showPage('orders',this)"><span class="nav-icon">üì¶</span> Orders <span class="nav-badge" id="pendingBadge">0</span></button>
        <div class="sb-section">Settings</div>
        <button class="nav-item" onclick="showPage('settings',this)"><span class="nav-icon">‚öôÔ∏è</span> Settings</button>
      </nav>
      <div class="sb-footer">
        <button class="logout-btn" onclick="doLogout()">üö™ Logout</button>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="main">
      <div class="topbar">
        <div class="topbar-title" id="pageTitle">Dashboard</div>
        <div class="topbar-right">
          <div class="topbar-admin">üë§ <span id="adminName">Admin</span></div>
          <a href="/" target="_blank" class="view-shop-btn">üõçÔ∏è View Shop</a>
        </div>
      </div>

      <div class="page-content">

        <!-- DASHBOARD -->
        <div id="page-dashboard" class="page active">
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card"><div class="stat-icon" style="background:#EFF6FF">üì¶</div><div><div class="stat-value" id="st-products">‚Äî</div><div class="stat-label">Total Products</div></div></div>
            <div class="stat-card"><div class="stat-icon" style="background:#FEF3C7">üìã</div><div><div class="stat-value" id="st-orders">‚Äî</div><div class="stat-label">Total Orders</div></div></div>
            <div class="stat-card"><div class="stat-icon" style="background:#FEE2E2">‚è≥</div><div><div class="stat-value" id="st-pending">‚Äî</div><div class="stat-label">Pending Orders</div></div></div>
            <div class="stat-card"><div class="stat-icon" style="background:#D1FAE5">‚úÖ</div><div><div class="stat-value" id="st-delivered">‚Äî</div><div class="stat-label">Delivered</div></div></div>
            <div class="stat-card"><div class="stat-icon" style="background:#EDE9FE">üí∞</div><div><div class="stat-value" id="st-revenue">‚Äî</div><div class="stat-label">Total Revenue</div></div></div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">üìã Recent Orders</div>
              <button class="btn btn-primary btn-sm" onclick="showPage('orders',document.querySelector('[onclick*=orders]'))">View All</button>
            </div>
            <div class="table-wrap"><table><thead><tr><th>Order No</th><th>Customer</th><th>Total</th><th>Status</th><th>Date</th></tr></thead><tbody id="recentOrdersTable"><tr><td colspan="5" style="text-align:center;color:#aaa;padding:30px">Loading...</td></tr></tbody></table></div>
          </div>
        </div>

        <!-- PRODUCTS PAGE -->
        <div id="page-products" class="page">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">üß∏ Product Management</div>
              <button class="btn btn-primary" onclick="openProductModal()">‚ûï Add New Product</button>
            </div>
            <div class="toolbar">
              <input type="text" placeholder="üîç Search products..." id="prodSearch" oninput="loadProducts()">
              <select id="prodCatFilter" onchange="loadProducts()">
                <option value="">All Categories</option>
                <option value="educational">Educational</option>
                <option value="outdoor">Outdoor</option>
                <option value="creative">Creative</option>
                <option value="vehicles">Vehicles</option>
                <option value="stuffed">Stuffed</option>
                <option value="electronic">Electronic</option>
              </select>
            </div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Photo</th><th>Name</th><th>Category</th><th>Price</th><th>Rating</th><th>Stock</th><th>Actions</th></tr></thead>
                <tbody id="productsTable"><tr><td colspan="7" style="text-align:center;color:#aaa;padding:30px">Loading...</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ORDERS PAGE -->
        <div id="page-orders" class="page">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">üì¶ Order Management</div>
              <div style="display:flex;gap:10px;">
                <select id="orderStatusFilter" onchange="loadOrders()" style="padding:8px 14px;border-radius:12px;border:2px solid var(--border);font-family:'Nunito',sans-serif;font-weight:700;font-size:13px;outline:none;">
                  <option value="all">All Orders</option>
                  <option value="pending">Pending</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="shipped">Shipped</option>
                  <option value="delivered">Delivered</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
            </div>
            <div class="toolbar">
              <input type="text" placeholder="üîç Search by name, phone, order no..." id="orderSearch" oninput="loadOrders()">
            </div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Order No</th><th>Customer</th><th>Phone</th><th>Items</th><th>Total</th><th>Payment</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead>
                <tbody id="ordersTable"><tr><td colspan="9" style="text-align:center;color:#aaa;padding:30px">Loading...</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- SETTINGS PAGE -->
        <div id="page-settings" class="page">
          <div class="panel" style="max-width:500px">
            <div class="panel-title" style="margin-bottom:22px">‚öôÔ∏è Shop Settings</div>
            <div class="m-fg"><label>WhatsApp Number</label><input type="text" id="setWA" placeholder="919876543210"></div>
            <div class="m-fg"><label>Shop Name</label><input type="text" id="setShopName" placeholder="A R S Toys" value="A R S Toys"></div>
            <div class="m-fg"><label>Shop Email</label><input type="text" id="setEmail" placeholder="arstoys@gmail.com"></div>
            <div class="m-fg"><label>Shop Phone (Display)</label><input type="text" id="setPhone" placeholder="+91 98765 43210"></div>
            <button class="btn btn-success" onclick="showToast('‚úÖ Settings saved!')">üíæ Save Settings</button>
          </div>
          <div class="panel" style="max-width:500px">
            <div class="panel-title" style="margin-bottom:22px">üîê Change Password</div>
            <div class="m-fg"><label>Current Password</label><input type="password" id="currPass" placeholder="Current password"></div>
            <div class="m-fg"><label>New Password</label><input type="password" id="newPass" placeholder="New password (min 6 chars)"></div>
            <div class="m-fg"><label>Confirm New Password</label><input type="password" id="confPass" placeholder="Confirm new password"></div>
            <button class="btn btn-primary" onclick="showToast('‚úÖ Password changed!')">üîí Update Password</button>
          </div>
        </div>

      </div><!-- /page-content -->
    </div><!-- /main -->
  </div><!-- /admin-wrap -->
</div><!-- /adminApp -->

<!-- PRODUCT MODAL -->
<div class="m-overlay" id="productModal" onclick="if(event.target===this)closeProductModal()">
  <div class="m-box">
    <div class="m-hd">
      <div class="m-title" id="prodModalTitle">‚ûï Add New Product</div>
      <button class="m-close" onclick="closeProductModal()">‚úï</button>
    </div>
    <div class="m-body">
      <input type="hidden" id="editProductId">
      <div class="m-row">
        <div class="m-fg"><label>Product Name *</label><input type="text" id="pName" placeholder="e.g. Rainbow Abacus"></div>
        <div class="m-fg"><label>Category *</label>
          <select id="pCat">
            <option value="educational">üß† Educational</option>
            <option value="outdoor">üèÉ Outdoor</option>
            <option value="creative">üé® Creative</option>
            <option value="vehicles">üöó Vehicles</option>
            <option value="stuffed">üß∏ Stuffed</option>
            <option value="electronic">‚ö° Electronic</option>
          </select>
        </div>
      </div>
      <div class="m-fg"><label>Description *</label><textarea id="pDesc" placeholder="Short description of the toy"></textarea></div>
      <div class="m-row">
        <div class="m-fg"><label>Price (‚Çπ) *</label><input type="number" id="pPrice" placeholder="449"></div>
        <div class="m-fg"><label>Original Price (‚Çπ)</label><input type="number" id="pOldPrice" placeholder="599 (for sale badge)"></div>
      </div>
      <div class="m-row">
        <div class="m-fg"><label>Age Group *</label><input type="text" id="pAge" placeholder="e.g. 3-8 yrs"></div>
        <div class="m-fg"><label>Badge</label>
          <select id="pBadge">
            <option value="">None</option>
            <option value="new">üÜï New</option>
            <option value="hot">üî• Hot</option>
            <option value="sale">üí∏ Sale</option>
            <option value="top">‚≠ê Top Pick</option>
          </select>
        </div>
      </div>
      <div class="m-row">
        <div class="m-fg"><label>Emoji</label><input type="text" id="pEmoji" placeholder="üß∏"></div>
        <div class="m-fg"><label>Rating (0-5)</label><input type="number" id="pRating" placeholder="4.5" min="0" max="5" step="0.1"></div>
      </div>
      <div class="m-fg"><label>Card Background Color</label><input type="color" id="pBg" value="#E3F2FD"></div>
      <div class="m-fg">
        <label>Product Photo</label>
        <input type="text" id="pImgUrl" placeholder="Paste image URL (from imgbb.com) OR upload below">
        <div style="margin-top:8px;font-size:12px;color:var(--muted);font-weight:700;">OR upload from your device:</div>
        <input type="file" id="pImgFile" accept="image/*" onchange="previewImg(this)" style="margin-top:6px;">
        <img id="imgPreview" class="img-preview" alt="Preview">
      </div>
      <div class="m-fg" style="display:flex;align-items:center;gap:10px;">
        <input type="checkbox" id="pInStock" checked style="width:18px;height:18px;cursor:pointer;">
        <label for="pInStock" style="margin-bottom:0;cursor:pointer">In Stock</label>
      </div>
    </div>
    <div class="m-ft">
      <button class="btn" onclick="closeProductModal()" style="background:var(--bg)">Cancel</button>
      <button class="btn btn-primary" onclick="saveProduct()">üíæ Save Product</button>
    </div>
  </div>
</div>

<!-- ORDER DETAIL MODAL -->
<div class="m-overlay" id="orderModal" onclick="if(event.target===this)closeOrderModal()">
  <div class="m-box">
    <div class="m-hd">
      <div class="m-title" id="orderModalTitle">üì¶ Order Details</div>
      <button class="m-close" onclick="closeOrderModal()">‚úï</button>
    </div>
    <div class="m-body" id="orderModalBody"></div>
    <div class="m-ft">
      <button class="btn" onclick="closeOrderModal()" style="background:var(--bg)">Close</button>
      <button class="btn btn-success" onclick="waContact()" id="waContactBtn">üí¨ WhatsApp Customer</button>
    </div>
  </div>
</div>

<div class="admin-toast" id="adminToast">‚úÖ Done!</div>

<script>
const API = '';
let token = localStorage.getItem('ars_token') || '';
let adminData = null;
let currentOrderPhone = '';

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
async function doLogin(){
  const email = document.getElementById('loginEmail').value.trim();
  const pass  = document.getElementById('loginPass').value;
  document.getElementById('loginErr').style.display = 'none';
  try {
    const r = await fetch(API+'/api/auth/login', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ email, password: pass })
    });
    const d = await r.json();
    if(d.success){
      token = d.token;
      adminData = d.admin;
      localStorage.setItem('ars_token', token);
      showAdmin();
    } else {
      document.getElementById('loginErr').textContent = d.message || 'Invalid credentials';
      document.getElementById('loginErr').style.display = 'block';
    }
  } catch(e) {
    document.getElementById('loginErr').textContent = 'Cannot connect to server. Make sure server is running.';
    document.getElementById('loginErr').style.display = 'block';
  }
}

function doLogout(){
  localStorage.removeItem('ars_token');
  token = '';
  document.getElementById('adminApp').style.display = 'none';
  document.getElementById('loginPage').style.display = 'flex';
}

function showAdmin(){
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('adminApp').style.display = 'block';
  document.getElementById('adminName').textContent = adminData?.name || 'Admin';
  loadDashboard();
  loadProducts();
  loadOrders();
}

// Auto-login if token exists
async function checkAuth(){
  if(!token) return;
  try {
    const r = await fetch(API+'/api/auth/me', { headers:{ Authorization:'Bearer '+token } });
    const d = await r.json();
    if(d.success){ adminData = d.admin; showAdmin(); }
    else { localStorage.removeItem('ars_token'); token=''; }
  } catch(e) {}
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function showPage(page, btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  if(btn) btn.classList.add('active');
  const titles = { dashboard:'üìä Dashboard', products:'üß∏ Products', orders:'üì¶ Orders', settings:'‚öôÔ∏è Settings' };
  document.getElementById('pageTitle').textContent = titles[page]||page;
}

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
async function loadDashboard(){
  try {
    const [pr, or, st] = await Promise.all([
      fetch(API+'/api/products').then(r=>r.json()),
      fetch(API+'/api/orders', { headers:{Authorization:'Bearer '+token} }).then(r=>r.json()),
      fetch(API+'/api/orders/stats', { headers:{Authorization:'Bearer '+token} }).then(r=>r.json())
    ]);
    if(pr.success) document.getElementById('st-products').textContent = pr.count;
    if(st.success){
      document.getElementById('st-orders').textContent   = st.stats.total;
      document.getElementById('st-pending').textContent  = st.stats.pending;
      document.getElementById('st-delivered').textContent= st.stats.delivered;
      document.getElementById('st-revenue').textContent  = '‚Çπ'+st.stats.revenue.toLocaleString('en-IN');
      document.getElementById('pendingBadge').textContent = st.stats.pending;
    }
    if(or.success){
      const recent = or.orders.slice(0,5);
      document.getElementById('recentOrdersTable').innerHTML = recent.length
        ? recent.map(o=>`<tr>
            <td><b>${o.orderNo}</b></td>
            <td>${o.customerName}</td>
            <td>‚Çπ${o.total}</td>
            <td><span class="status-badge status-${o.status}">${o.status}</span></td>
            <td>${new Date(o.createdAt).toLocaleDateString('en-IN')}</td>
          </tr>`).join('')
        : `<tr><td colspan="5" style="text-align:center;color:#aaa;padding:30px">No orders yet</td></tr>`;
    }
  } catch(e) {}
}

// ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ
async function loadProducts(){
  const search = document.getElementById('prodSearch').value;
  const cat    = document.getElementById('prodCatFilter').value;
  let url = API+'/api/products?';
  if(search) url += 'search='+search+'&';
  if(cat)    url += 'category='+cat;
  try {
    const r = await fetch(url);
    const d = await r.json();
    if(!d.success) return;
    const tbody = document.getElementById('productsTable');
    if(!d.products.length){
      tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="ei">üß∏</div><p>No products found</p></div></td></tr>`;
      return;
    }
    tbody.innerHTML = d.products.map(p => {
      const imgHTML = p.img
        ? `<div class="td-img"><img src="${p.img.startsWith('http')?p.img:API+p.img}" alt="${p.name}" onerror="this.parentElement.innerHTML='${p.emoji}'"></div>`
        : `<div class="td-img">${p.emoji}</div>`;
      const stars = '‚òÖ'.repeat(Math.floor(p.rating||0)) + '‚òÜ'.repeat(5-Math.floor(p.rating||0));
      return `<tr>
        <td>${imgHTML}</td>
        <td><b>${p.name}</b></td>
        <td><span style="background:#F3F4F6;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:800">${p.category}</span></td>
        <td><b>‚Çπ${p.price}</b>${p.originalPrice?`<br><span style="text-decoration:line-through;color:#aaa;font-size:12px">‚Çπ${p.originalPrice}</span>`:''}</td>
        <td><span class="star-display">${stars}</span> <span style="font-size:12px;color:#aaa">${p.rating||0}</span></td>
        <td><span class="status-badge ${p.inStock?'status-delivered':'status-cancelled'}">${p.inStock?'In Stock':'Out of Stock'}</span></td>
        <td style="white-space:nowrap">
          <button class="btn btn-warning btn-sm" onclick="editProduct('${p._id}')">‚úèÔ∏è Edit</button>
          <button class="btn btn-danger btn-sm" style="margin-left:6px" onclick="deleteProduct('${p._id}','${p.name}')">üóëÔ∏è</button>
        </td>
      </tr>`;
    }).join('');
  } catch(e) {}
}

function openProductModal(p=null){
  document.getElementById('editProductId').value = '';
  document.getElementById('pName').value=''; document.getElementById('pCat').value='educational';
  document.getElementById('pDesc').value=''; document.getElementById('pPrice').value='';
  document.getElementById('pOldPrice').value=''; document.getElementById('pAge').value='';
  document.getElementById('pBadge').value='new'; document.getElementById('pEmoji').value='üß∏';
  document.getElementById('pRating').value=''; document.getElementById('pBg').value='#E3F2FD';
  document.getElementById('pImgUrl').value=''; document.getElementById('pImgFile').value='';
  document.getElementById('imgPreview').style.display='none';
  document.getElementById('pInStock').checked=true;
  document.getElementById('prodModalTitle').textContent = '‚ûï Add New Product';
  document.getElementById('productModal').classList.add('open');
}

async function editProduct(id){
  try {
    const r = await fetch(API+'/api/products/'+id);
    const d = await r.json();
    if(!d.success) return;
    const p = d.product;
    document.getElementById('editProductId').value = p._id;
    document.getElementById('pName').value    = p.name;
    document.getElementById('pCat').value     = p.category;
    document.getElementById('pDesc').value    = p.desc;
    document.getElementById('pPrice').value   = p.price;
    document.getElementById('pOldPrice').value= p.originalPrice||'';
    document.getElementById('pAge').value     = p.age;
    document.getElementById('pBadge').value   = p.badge||'';
    document.getElementById('pEmoji').value   = p.emoji||'üß∏';
    document.getElementById('pRating').value  = p.rating||'';
    document.getElementById('pBg').value      = p.bg||'#E3F2FD';
    document.getElementById('pImgUrl').value  = p.img||'';
    document.getElementById('pInStock').checked = p.inStock;
    if(p.img){ const pr=document.getElementById('imgPreview'); pr.src=p.img.startsWith('http')?p.img:API+p.img; pr.style.display='block'; }
    document.getElementById('prodModalTitle').textContent = '‚úèÔ∏è Edit Product';
    document.getElementById('productModal').classList.add('open');
  } catch(e) {}
}

function previewImg(input){
  if(input.files && input.files[0]){
    const reader = new FileReader();
    reader.onload = e => {
      const pr = document.getElementById('imgPreview');
      pr.src = e.target.result; pr.style.display='block';
    };
    reader.readAsDataURL(input.files[0]);
  }
}

async function saveProduct(){
  const id   = document.getElementById('editProductId').value;
  const name = document.getElementById('pName').value.trim();
  const price= document.getElementById('pPrice').value;
  const age  = document.getElementById('pAge').value.trim();
  const desc = document.getElementById('pDesc').value.trim();
  if(!name||!price||!age||!desc){ showToast('‚ö†Ô∏è Fill required fields!'); return; }

  const fd = new FormData();
  fd.append('name',   name);
  fd.append('category', document.getElementById('pCat').value);
  fd.append('desc',   desc);
  fd.append('price',  price);
  fd.append('originalPrice', document.getElementById('pOldPrice').value||'');
  fd.append('age',    age);
  fd.append('badge',  document.getElementById('pBadge').value);
  fd.append('emoji',  document.getElementById('pEmoji').value||'üß∏');
  fd.append('rating', document.getElementById('pRating').value||'0');
  fd.append('bg',     document.getElementById('pBg').value);
  fd.append('inStock',document.getElementById('pInStock').checked);

  const imgUrl  = document.getElementById('pImgUrl').value.trim();
  const imgFile = document.getElementById('pImgFile').files[0];
  if(imgUrl && !imgFile) fd.append('img', imgUrl);
  if(imgFile) fd.append('image', imgFile);

  try {
    const url = id ? API+'/api/products/'+id : API+'/api/products';
    const r = await fetch(url, {
      method: id ? 'PUT' : 'POST',
      headers: { Authorization:'Bearer '+token },
      body: fd
    });
    const d = await r.json();
    if(d.success){ showToast(id?'‚úÖ Product updated!':'‚úÖ Product added!'); closeProductModal(); loadProducts(); loadDashboard(); }
    else showToast('‚ùå '+d.message);
  } catch(e){ showToast('‚ùå Error saving product'); }
}

async function deleteProduct(id, name){
  if(!confirm(`Delete "${name}"? This cannot be undone.`)) return;
  try {
    const r = await fetch(API+'/api/products/'+id, {
      method:'DELETE', headers:{Authorization:'Bearer '+token}
    });
    const d = await r.json();
    if(d.success){ showToast('üóëÔ∏è Product deleted!'); loadProducts(); loadDashboard(); }
    else showToast('‚ùå '+d.message);
  } catch(e){ showToast('‚ùå Error deleting'); }
}

function closeProductModal(){ document.getElementById('productModal').classList.remove('open'); }

// ‚îÄ‚îÄ ORDERS ‚îÄ‚îÄ
async function loadOrders(){
  const status = document.getElementById('orderStatusFilter').value;
  const search = document.getElementById('orderSearch').value;
  let url = API+'/api/orders?';
  if(status && status!=='all') url+='status='+status+'&';
  if(search) url+='search='+search;
  try {
    const r = await fetch(url, { headers:{Authorization:'Bearer '+token} });
    const d = await r.json();
    if(!d.success) return;
    const tbody = document.getElementById('ordersTable');
    if(!d.orders.length){
      tbody.innerHTML = `<tr><td colspan="9"><div class="empty-state"><div class="ei">üì¶</div><p>No orders found</p></div></td></tr>`;
      return;
    }
    tbody.innerHTML = d.orders.map(o => `<tr>
      <td><b>${o.orderNo}</b></td>
      <td>${o.customerName}</td>
      <td>${o.phone}</td>
      <td style="font-size:12px">${o.items.length} item${o.items.length>1?'s':''}</td>
      <td><b>‚Çπ${o.total}</b></td>
      <td style="text-transform:uppercase;font-size:12px;font-weight:800">${o.paymentMode}</td>
      <td>
        <select onchange="updateOrderStatus('${o._id}',this.value)" style="padding:5px 10px;border-radius:8px;border:2px solid var(--border);font-family:'Nunito',sans-serif;font-weight:800;font-size:12px;outline:none;cursor:pointer;">
          ${['pending','confirmed','shipped','delivered','cancelled'].map(s=>`<option value="${s}" ${o.status===s?'selected':''}>${s}</option>`).join('')}
        </select>
      </td>
      <td style="font-size:12px">${new Date(o.createdAt).toLocaleDateString('en-IN')}</td>
      <td style="white-space:nowrap">
        <button class="btn btn-primary btn-sm" onclick="viewOrder('${o._id}')">üëÅÔ∏è View</button>
        <button class="btn btn-sm" style="background:#EDE9FE;color:#7C3AED;margin-left:5px" onclick="waCustomer('${o.phone}','${o.customerName}','${o.orderNo}')">üí¨</button>
        <button class="btn btn-danger btn-sm" style="margin-left:5px" onclick="deleteOrder('${o._id}','${o.orderNo}')">üóëÔ∏è Delete</button>
      </td>
    </tr>`).join('');
  } catch(e) {}
}

async function updateOrderStatus(id, status){
  try {
    const r = await fetch(API+'/api/orders/'+id+'/status', {
      method:'PUT', headers:{Authorization:'Bearer '+token,'Content-Type':'application/json'},
      body: JSON.stringify({ status })
    });
    const d = await r.json();
    if(d.success){ showToast('‚úÖ Status updated!'); loadDashboard(); }
  } catch(e) {}
}

async function viewOrder(id){
  try {
    // Find from loaded data
    const r = await fetch(API+'/api/orders?', { headers:{Authorization:'Bearer '+token} });
    const d = await r.json();
    const order = d.orders.find(o=>o._id===id);
    if(!order) return;
    currentOrderPhone = order.phone;
    document.getElementById('orderModalTitle').textContent = 'üì¶ Order #'+order.orderNo;
    document.getElementById('orderModalBody').innerHTML = `
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px">
        <div><div style="font-size:11px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Customer</div><div style="font-weight:800;font-size:16px">${order.customerName}</div></div>
        <div><div style="font-size:11px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Phone</div><div style="font-weight:800;font-size:16px">${order.phone}</div></div>
        <div><div style="font-size:11px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Payment</div><div style="font-weight:800;text-transform:uppercase">${order.paymentMode}</div></div>
        <div><div style="font-size:11px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Status</div><span class="status-badge status-${order.status}">${order.status}</span></div>
        ${order.address?`<div style="grid-column:1/-1"><div style="font-size:11px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Address</div><div style="font-weight:700">${order.address}</div></div>`:''}
      </div>
      <div style="background:var(--bg);border-radius:14px;padding:16px;margin-bottom:16px">
        <div style="font-weight:900;font-size:13px;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted)">Order Items</div>
        ${order.items.map(item=>`
          <div style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px dashed #e5e7eb">
            <div style="font-size:28px">${item.emoji||'üß∏'}</div>
            <div style="flex:1"><div style="font-weight:800">${item.name}</div><div style="font-size:13px;color:var(--muted)">‚Çπ${item.price} √ó ${item.qty}</div></div>
            <div style="font-weight:900">‚Çπ${item.price*item.qty}</div>
          </div>`).join('')}
        <div style="display:flex;justify-content:space-between;margin-top:12px;font-family:'Fredoka One',cursive;font-size:20px">
          <span>Total</span><span>‚Çπ${order.total}</span>
        </div>
      </div>
      ${order.notes?`<div style="background:#FEF3C7;border-radius:12px;padding:12px 16px;font-size:13px;font-weight:700"><b>üìù Notes:</b> ${order.notes}</div>`:''}
    `;
    document.getElementById('orderModal').classList.add('open');
  } catch(e) {}
}

function waCustomer(phone, name, orderNo){
  const msg = `Hi ${name}! üëã This is ARS Toys regarding your order #${orderNo}. `;
  window.open(`https://wa.me/${phone.replace(/\D/g,'')}?text=${encodeURIComponent(msg)}`, '_blank');
}

function waContact(){
  if(currentOrderPhone) window.open(`https://wa.me/${currentOrderPhone.replace(/\D/g,'')}`, '_blank');
}

async function deleteOrder(id, orderNo){
  if(!confirm(`Delete order "${orderNo}"? This cannot be undone.`)) return;
  try {
    const r = await fetch(API+'/api/orders/'+id, {
      method:'DELETE', headers:{Authorization:'Bearer '+token}
    });
    const d = await r.json();
    if(d.success){ showToast('üóëÔ∏è Order '+orderNo+' deleted!'); loadOrders(); loadDashboard(); }
    else showToast('‚ùå '+d.message);
  } catch(e){ showToast('‚ùå Error deleting order'); }
}

function closeOrderModal(){ document.getElementById('orderModal').classList.remove('open'); }

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function showToast(msg){
  const t = document.getElementById('adminToast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2600);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
checkAuth();
</script>
</body>
</html>
