<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A R S TOYS ‚Äì Where Play Begins!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --red:#FF3A3A; --yellow:#FFD600; --blue:#1A6FFF; --green:#00C16A;
  --purple:#9B5DE5; --orange:#FF7B00; --pink:#FF4D8D;
  --bg:#FFF8F0; --dark:#1A1A2E; --white:#FFFFFF;
  --shadow:0 8px 32px rgba(0,0,0,0.12);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--dark);overflow-x:hidden;}

/* HEADER */
header{background:var(--dark);position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
.header-top{background:var(--yellow);text-align:center;padding:6px;font-size:13px;font-weight:800;color:var(--dark);}
.header-main{display:flex;align-items:center;justify-content:space-between;padding:14px 40px;}
.logo{display:flex;align-items:center;gap:14px;text-decoration:none;}
.logo-icon{width:52px;height:52px;background:var(--yellow);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px;transform:rotate(-5deg);box-shadow:4px 4px 0 var(--orange);}
.logo-text{font-family:'Fredoka One',cursive;font-size:32px;color:var(--white);line-height:1;}
.logo-text span{color:var(--yellow);}
.logo-sub{font-size:11px;color:#aaa;font-weight:700;letter-spacing:2px;text-transform:uppercase;}
.header-actions{display:flex;align-items:center;gap:12px;}
.cart-btn{background:var(--yellow);color:var(--dark);border:none;border-radius:50px;padding:10px 22px;font-family:'Nunito',sans-serif;font-weight:800;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:transform .2s,box-shadow .2s;box-shadow:3px 3px 0 var(--orange);}
.cart-btn:hover{transform:translateY(-2px);box-shadow:5px 5px 0 var(--orange);}
.cart-count{background:var(--red);color:white;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:900;}
.admin-link{color:#aaa;text-decoration:none;font-size:13px;font-weight:700;padding:8px 16px;border:1.5px solid #444;border-radius:50px;transition:all .2s;}
.admin-link:hover{color:var(--yellow);border-color:var(--yellow);}

/* HERO */
.hero{background:linear-gradient(135deg,var(--dark) 0%,#2D1B69 50%,#1A2F6B 100%);padding:70px 40px 80px;text-align:center;position:relative;overflow:hidden;}
.hero::before{content:'';position:absolute;top:-60px;right:-60px;width:300px;height:300px;background:var(--yellow);border-radius:50%;opacity:.07;}
.hero h1{font-family:'Fredoka One',cursive;font-size:clamp(38px,6vw,70px);color:var(--white);line-height:1.1;margin-bottom:16px;position:relative;z-index:1;}
.hero h1 .hi{color:var(--yellow);display:inline-block;animation:wobble 3s ease-in-out infinite;}
@keyframes wobble{0%,100%{transform:rotate(-2deg);}50%{transform:rotate(2deg);}}
.hero p{color:rgba(255,255,255,.75);font-size:18px;font-weight:600;max-width:600px;margin:0 auto 36px;position:relative;z-index:1;}
.hero-badges{display:flex;justify-content:center;gap:10px;margin-bottom:24px;flex-wrap:wrap;}
.hbadge{background:rgba(255,255,255,.12);color:white;padding:6px 16px;border-radius:50px;font-size:12px;font-weight:800;letter-spacing:1px;border:1px solid rgba(255,255,255,.2);}
.hbadge.y{background:var(--yellow);color:var(--dark);border-color:var(--yellow);}
.hero-cta{display:inline-flex;align-items:center;gap:10px;background:var(--green);color:white;padding:16px 36px;border-radius:50px;font-size:18px;font-weight:900;text-decoration:none;box-shadow:0 6px 0 #009950;transition:transform .15s,box-shadow .15s;border:none;cursor:pointer;font-family:'Nunito',sans-serif;}
.hero-cta:hover{transform:translateY(-3px);box-shadow:0 9px 0 #009950;}

/* FILTERS */
.filters-section{background:var(--white);padding:22px 40px;box-shadow:0 2px 12px rgba(0,0,0,.06);position:sticky;top:92px;z-index:90;}
.filters-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.filter-label{font-weight:900;font-size:13px;color:var(--dark);letter-spacing:1px;text-transform:uppercase;margin-right:4px;}
.filter-btn{padding:7px 18px;border-radius:50px;border:2.5px solid #E0E0E0;background:white;font-family:'Nunito',sans-serif;font-weight:800;font-size:12px;cursor:pointer;transition:all .2s;color:var(--dark);}
.filter-btn:hover,.filter-btn.active{background:var(--dark);border-color:var(--dark);color:var(--yellow);}
.search-wrap{margin-left:auto;position:relative;}
.search-wrap input{padding:10px 20px 10px 42px;border-radius:50px;border:2.5px solid #E0E0E0;font-family:'Nunito',sans-serif;font-weight:700;font-size:13px;outline:none;width:220px;transition:border-color .2s;}
.search-wrap input:focus{border-color:var(--blue);}
.search-wrap::before{content:'üîç';position:absolute;left:13px;top:50%;transform:translateY(-50%);font-size:15px;}

/* PRODUCTS */
.products-section{max-width:1200px;margin:0 auto;padding:50px 40px;}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:36px;}
.section-title{font-family:'Fredoka One',cursive;font-size:36px;color:var(--dark);}
.section-title span{color:var(--blue);}
.product-count{background:var(--dark);color:var(--yellow);padding:8px 18px;border-radius:50px;font-weight:900;font-size:14px;}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:28px;}

/* PRODUCT CARD */
.product-card{background:var(--white);border-radius:24px;overflow:hidden;box-shadow:var(--shadow);transition:transform .3s,box-shadow .3s;position:relative;border:2px solid transparent;}
.product-card:hover{transform:translateY(-8px);box-shadow:0 20px 50px rgba(0,0,0,.18);border-color:var(--yellow);}
.product-img-wrap{height:220px;position:relative;overflow:hidden;background:#f5f5f5;display:flex;align-items:center;justify-content:center;}
.product-img-wrap img{width:100%;height:220px;object-fit:cover;object-position:center;transition:transform .35s;}
.product-card:hover .product-img-wrap img{transform:scale(1.08);}
.img-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;gap:6px;color:#ccc;}
.img-placeholder span{font-size:72px;}
.img-placeholder p{font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;}
.pbadge{position:absolute;top:12px;left:12px;padding:5px 12px;border-radius:50px;font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:1px;z-index:2;}
.badge-new{background:var(--green);color:white;}
.badge-hot{background:var(--red);color:white;}
.badge-sale{background:var(--orange);color:white;}
.badge-top{background:var(--purple);color:white;}
.stock-badge{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.6);color:white;padding:4px 10px;border-radius:50px;font-size:10px;font-weight:900;}
.product-info{padding:18px 20px 20px;}
.product-cat{font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:2px;color:var(--blue);margin-bottom:5px;}
.product-name{font-family:'Fredoka One',cursive;font-size:19px;color:var(--dark);margin-bottom:5px;line-height:1.2;}
.product-desc{font-size:12.5px;color:#777;font-weight:600;margin-bottom:10px;line-height:1.4;}
.stars{display:flex;align-items:center;gap:4px;margin-bottom:12px;}
.stars-icons{color:var(--yellow);font-size:13px;}
.stars-count{font-size:12px;color:#aaa;font-weight:700;}
.product-footer{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.price-main{font-family:'Fredoka One',cursive;font-size:26px;color:var(--dark);line-height:1;}
.price-old{font-size:12px;color:#aaa;text-decoration:line-through;font-weight:700;}
.age-tag{font-size:11px;background:var(--bg);color:#666;padding:4px 10px;border-radius:20px;font-weight:800;border:1.5px solid #E8E8E8;}
.order-btn{width:100%;padding:12px;border-radius:14px;border:none;background:var(--dark);color:var(--yellow);font-family:'Nunito',sans-serif;font-weight:900;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .2s;}
.order-btn:hover{background:var(--green);color:white;transform:scale(1.02);}
.order-btn:disabled{background:#ccc;color:#888;cursor:not-allowed;transform:none;}

/* LOADING */
.loading-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:28px;}
.skeleton{background:white;border-radius:24px;overflow:hidden;box-shadow:var(--shadow);}
.skeleton-img{height:220px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;}
.skeleton-body{padding:18px;}
.skeleton-line{height:14px;border-radius:8px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;margin-bottom:10px;}
.skeleton-line.short{width:60%;}
@keyframes shimmer{0%{background-position:200% 0;}100%{background-position:-200% 0;}}

/* CART MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.overlay.open{display:flex;}
.modal{background:var(--white);border-radius:28px;width:90%;max-width:500px;max-height:85vh;overflow:hidden;display:flex;flex-direction:column;animation:popIn .3s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{transform:scale(.85);opacity:0;}to{transform:scale(1);opacity:1;}}
.modal-hd{background:var(--dark);padding:20px 26px;display:flex;align-items:center;justify-content:space-between;}
.modal-title{font-family:'Fredoka One',cursive;font-size:22px;color:var(--yellow);}
.modal-close{background:rgba(255,255,255,.15);border:none;color:white;width:34px;height:34px;border-radius:50%;font-size:17px;cursor:pointer;transition:background .2s;}
.modal-close:hover{background:var(--red);}
.modal-body{padding:22px 26px;overflow-y:auto;flex:1;}
.cart-item{display:flex;align-items:center;gap:14px;padding:12px 0;border-bottom:2px dashed #F0F0F0;}
.cart-thumb{width:56px;height:56px;border-radius:12px;object-fit:cover;background:#f5f5f5;display:flex;align-items:center;justify-content:center;font-size:28px;overflow:hidden;flex-shrink:0;}
.cart-thumb img{width:100%;height:100%;object-fit:cover;}
.cart-info{flex:1;}
.cart-name{font-family:'Fredoka One',cursive;font-size:16px;color:var(--dark);}
.cart-price{font-weight:800;color:var(--blue);font-size:14px;}
.qty-ctrl{display:flex;align-items:center;gap:8px;}
.qty-btn{width:28px;height:28px;border-radius:50%;border:2px solid var(--dark);background:none;font-size:15px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;font-family:'Nunito',sans-serif;}
.qty-btn:hover{background:var(--dark);color:var(--yellow);}
.cart-empty{text-align:center;padding:40px 20px;color:#aaa;}
.cart-empty .ei{font-size:56px;margin-bottom:12px;}
.modal-ft{padding:18px 26px;border-top:2px solid #F0F0F0;background:var(--bg);}
.cart-total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.ct-label{font-weight:900;font-size:15px;}
.ct-price{font-family:'Fredoka One',cursive;font-size:26px;color:var(--dark);}
.wa-order-btn{width:100%;padding:15px;background:var(--green);color:white;border:none;border-radius:16px;font-family:'Nunito',sans-serif;font-weight:900;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 5px 0 #009950;transition:all .15s;}
.wa-order-btn:hover{background:#00d973;transform:translateY(-2px);box-shadow:0 7px 0 #009950;}

/* ORDER FORM MODAL */
.order-form .form-group{margin-bottom:16px;}
.order-form label{display:block;font-weight:800;font-size:13px;margin-bottom:6px;color:var(--dark);}
.order-form input,.order-form textarea,.order-form select{width:100%;padding:11px 16px;border-radius:12px;border:2px solid #E0E0E0;font-family:'Nunito',sans-serif;font-weight:700;font-size:14px;outline:none;transition:border-color .2s;}
.order-form input:focus,.order-form textarea:focus,.order-form select:focus{border-color:var(--blue);}
.order-form textarea{resize:vertical;min-height:70px;}
.submit-order-btn{width:100%;padding:15px;background:var(--green);color:white;border:none;border-radius:16px;font-family:'Nunito',sans-serif;font-weight:900;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 5px 0 #009950;transition:all .15s;margin-top:8px;}
.submit-order-btn:hover{background:#00d973;transform:translateY(-2px);}

/* WA FLOAT */
.wa-float{position:fixed;bottom:30px;right:30px;width:62px;height:62px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 6px 24px rgba(0,193,106,.5);cursor:pointer;text-decoration:none;z-index:999;animation:pulseWA 2s infinite;}
.wa-float:hover{transform:scale(1.12);}
@keyframes pulseWA{0%,100%{box-shadow:0 6px 24px rgba(0,193,106,.5);}50%{box-shadow:0 6px 40px rgba(0,193,106,.8);}}

/* TOAST */
.toast{position:fixed;bottom:108px;right:30px;background:var(--dark);color:var(--yellow);padding:12px 20px;border-radius:50px;font-weight:900;font-size:13px;z-index:999;transform:translateY(20px);opacity:0;transition:all .3s;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.3);}
.toast.show{transform:translateY(0);opacity:1;}

/* NO RESULTS */
.no-results{grid-column:1/-1;text-align:center;padding:60px 20px;color:#aaa;}
.no-results .ni{font-size:64px;margin-bottom:14px;}

/* FOOTER */
footer{background:var(--dark);padding:50px 40px 30px;text-align:center;}
.footer-logo{font-family:'Fredoka One',cursive;font-size:40px;color:var(--yellow);margin-bottom:8px;}
.footer-tag{color:rgba(255,255,255,.5);font-weight:600;margin-bottom:28px;}
.footer-links{display:flex;justify-content:center;gap:28px;margin-bottom:28px;flex-wrap:wrap;}
.footer-links a{color:rgba(255,255,255,.7);text-decoration:none;font-weight:700;font-size:14px;transition:color .2s;}
.footer-links a:hover{color:var(--yellow);}
.footer-contact{background:rgba(255,255,255,.06);border-radius:16px;padding:14px 26px;display:inline-flex;align-items:center;gap:12px;margin-bottom:28px;color:white;font-weight:700;font-size:15px;}
.footer-copy{color:rgba(255,255,255,.3);font-size:13px;font-weight:600;}

@media(max-width:768px){
  .header-main{padding:12px 20px;}
  .logo-text{font-size:24px;} .logo-sub{display:none;}
  .hero{padding:50px 20px 60px;}
  .filters-section{padding:16px 20px;top:76px;}
  .search-wrap{margin-left:0;width:100%;}
  .search-wrap input{width:100%;}
  .products-section{padding:30px 20px;}
  footer{padding:36px 20px 24px;}
  .admin-link{display:none;}
}
</style>
</head>
<body>

<header>
  <div class="header-top">üéâ FREE DELIVERY on orders above ‚Çπ499 | ORDER via WhatsApp üì±</div>
  <div class="header-main">
    <a href="/" class="logo">
      <div class="logo-icon">üß∏</div>
      <div>
        <div class="logo-text">A R S <span>TOYS</span></div>
        <div class="logo-sub">GSTIN:33CJAPA6582L1Z7</div>
        <div class="logo-sub">7/1 Jeevanatham salai</div>
        <div class="logo-sub">Arcot -632503</div>

      </div>
    </a>
    <div class="header-actions">
      <a href="/admin.html" class="admin-link">üõ°Ô∏è Admin</a>
      <button class="cart-btn" onclick="openCart()">
        üõí My Cart <span class="cart-count" id="cartCount">0</span>
      </button>
    </div>
  </div>
</header>

<section class="hero">
  <div class="hero-badges">
    <span class="hbadge y">üéÅ 100% Safe & Tested</span>
    <span class="hbadge">üöö Fast Delivery</span>
    <span class="hbadge">‚≠ê Premium Quality</span>
  </div>
  <h1>Toys That <span class="hi">Spark Joy</span><br>&amp; Imagination!</h1>
  <p>Discover amazing toys for every age. Order directly via WhatsApp ‚Äî fast, easy &amp; fun!</p>
  <button class="hero-cta" onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})">üéÆ Shop Now</button>
</section>

<section class="filters-section">
  <div class="filters-inner">
    <span class="filter-label">Category:</span>
    <button class="filter-btn active" data-filter="all">All Toys</button>
    <button class="filter-btn" data-filter="educational">üß† Educational</button>
    <button class="filter-btn" data-filter="outdoor">üèÉ Outdoor</button>
    <button class="filter-btn" data-filter="creative">üé® Creative</button>
    <button class="filter-btn" data-filter="vehicles">üöó Vehicles</button>
    <button class="filter-btn" data-filter="stuffed">üß∏ Stuffed</button>
    <button class="filter-btn" data-filter="electronic">‚ö° Electronic</button>
    <div class="search-wrap">
      <input type="text" placeholder="Search toys..." id="searchInput" oninput="filterProducts()">
    </div>
  </div>
</section>

<section class="products-section" id="products">
  <div class="section-header">
    <h2 class="section-title">Our <span>Products</span></h2>
    <span class="product-count" id="productCount">Loading...</span>
  </div>
  <div id="productsGrid" class="loading-grid">
    ${[1,2,3,4,5,6].map(()=>`<div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line"></div></div></div>`).join('')}
  </div>
</section>

<footer>
  <div class="footer-logo">A R S TOYS</div>
   <div class="footer-logo">GSTIN : 33CJAPA6582L1Z7</div>
   <div class="footer-logo">7/1 JEEVANATHAM SALAI</div>
   <div class="footer-logo">ARCOT-632503</div>
  <div class="footer-tag">Where every child finds their favourite toy üåü</div>
  <div class="footer-contact">üì± +91 9894995660 &nbsp;|&nbsp; üìß arstoys6@gmail.com</div>
  <div class="footer-links">
    <a href="/">Home</a>
    <a href="#products">Products</a>
    <a href="/admin.html">Admin Panel</a>
    <a href="#" id="waLink">WhatsApp Us</a>
  </div>
  <div class="footer-copy">¬© 2025 A R S Toys. All rights reserved.</div>
</footer>

<a class="wa-float" id="waFloat" href="#" target="_blank">üí¨</a>
<div class="toast" id="toast">‚úÖ Added!</div>

<!-- CART MODAL -->
<div class="overlay" id="cartOverlay" onclick="if(event.target===this)closeCart()">
  <div class="modal">
    <div class="modal-hd">
      <div class="modal-title">üõí Your Cart</div>
      <button class="modal-close" onclick="closeCart()">‚úï</button>
    </div>
    <div class="modal-body" id="cartBody"></div>
    <div class="modal-ft" id="cartFt" style="display:none">
      <div class="cart-total-row">
        <span class="ct-label">Total Amount</span>
        <span class="ct-price" id="cartTotal">‚Çπ0</span>
      </div>
      <button class="wa-order-btn" onclick="openOrderForm()">
        <span style="font-size:20px">üí¨</span> Place Order
      </button>
    </div>
  </div>
</div>

<!-- ORDER FORM MODAL -->
<div class="overlay" id="orderOverlay" onclick="if(event.target===this)closeOrderForm()">
  <div class="modal">
    <div class="modal-hd">
      <div class="modal-title">üì¶ Your Details</div>
      <button class="modal-close" onclick="closeOrderForm()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="order-form">
        <div class="form-group">
          <label>Your Name *</label>
          <input type="text" id="custName" placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="tel" id="custPhone" placeholder="10-digit mobile number">
        </div>
        <div class="form-group">
          <label>Delivery Address</label>
          <textarea id="custAddr" placeholder="House No, Street, City, Pincode"></textarea>
        </div>
        <div class="form-group">
          <label>Payment Mode</label>
          <select id="payMode">
            <option value="cod">üíµ Cash on Delivery</option>
            <option value="upi">üì± UPI / GPay</option>
            <option value="online">üí≥ Online Payment</option>
          </select>
        </div>
        <div class="form-group">
          <label>Special Notes (optional)</label>
          <textarea id="custNotes" placeholder="Any special instructions..."></textarea>
        </div>
        <button class="submit-order-btn" onclick="submitOrder()">
          <span style="font-size:20px">üí¨</span> Confirm & Order on WhatsApp
        </button>
      </div>
    </div>
  </div>
</div>

<script>
const API = '';
let allProducts = [];
let cart = [];
let currentFilter = 'all';
let waNumber = '919876543210';

// Fetch config
async function loadConfig() {
  try {
    const r = await fetch(API + '/api/config');
    const d = await r.json();
    waNumber = d.waNumber || waNumber;
    document.getElementById('waFloat').href = `https://wa.me/${waNumber}?text=Hi%20ARS%20Toys!`;
    document.getElementById('waLink').href  = `https://wa.me/${waNumber}?text=Hi%20ARS%20Toys!`;
  } catch(e) {}
}

// Star rating HTML
function stars(rating) {
  const full = Math.floor(rating);
  const half = rating % 1 >= 0.5 ? 1 : 0;
  const empty = 5 - full - half;
  return '‚òÖ'.repeat(full) + (half?'¬Ω':'') + '‚òÜ'.repeat(empty);
}

// Render products
function renderProducts(list) {
  const grid = document.getElementById('productsGrid');
  grid.className = 'products-grid';
  document.getElementById('productCount').textContent = list.length + ' Toys';
  if (!list.length) {
    grid.innerHTML = `<div class="no-results"><div class="ni">üîç</div><p>No toys found! Try a different search.</p></div>`;
    return;
  }
  const badgeMap = { new:'üÜï New', hot:'üî• Hot', sale:'üí∏ Sale', top:'‚≠ê Top Pick' };
  grid.innerHTML = list.map(p => {
    const imgHTML = p.img
      ? `<img src="${p.img.startsWith('http') ? p.img : API + p.img}" alt="${p.name}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'img-placeholder\\'><span>${p.emoji}</span></div>'">`
      : `<div class="img-placeholder"><span>${p.emoji}</span></div>`;
    const disc = p.originalPrice ? Math.round((1 - p.price/p.originalPrice)*100) : 0;
    return `
    <div class="product-card">
      <div class="product-img-wrap" style="background:${p.bg}">
        ${p.badge ? `<span class="pbadge badge-${p.badge}">${badgeMap[p.badge]||p.badge}</span>` : ''}
        ${!p.inStock ? `<span class="stock-badge">Out of Stock</span>` : ''}
        ${imgHTML}
      </div>
      <div class="product-info">
        <div class="product-cat">${p.category.toUpperCase()}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc}</div>
        <div class="stars">
          <span class="stars-icons">${stars(p.rating||0)}</span>
          <span class="stars-count">${p.rating||0} (${p.reviews||0})</span>
          ${disc>0?`<span style="margin-left:auto;background:#FEF3C7;color:#D97706;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:900">${disc}% OFF</span>`:''}
        </div>
        <div class="product-footer">
          <div>
            <div class="price-main">‚Çπ${p.price}</div>
            ${p.originalPrice ? `<div class="price-old">‚Çπ${p.originalPrice}</div>` : ''}
          </div>
          <span class="age-tag">üë∂ ${p.age}</span>
        </div>
        <button class="order-btn" onclick="addToCart('${p._id||p.id}',event)" ${!p.inStock?'disabled':''}>
          <span style="font-size:18px">üí¨</span> ${p.inStock ? 'Add to Cart' : 'Out of Stock'}
        </button>
      </div>
    </div>`;
  }).join('');
}

// Fetch products from API
async function fetchProducts() {
  try {
    const r = await fetch(API + '/api/products');
    const d = await r.json();
    if (d.success) {
      allProducts = d.products;
      filterProducts();
    }
  } catch(e) {
    // Fallback: use sample data
    renderProducts([]);
    document.getElementById('productCount').textContent = 'Server offline';
  }
}

function filterProducts() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const filtered = allProducts.filter(p => {
    const matchCat = currentFilter === 'all' || p.category === currentFilter;
    const matchSearch = !search || p.name.toLowerCase().includes(search) || p.desc.toLowerCase().includes(search);
    return matchCat && matchSearch;
  });
  renderProducts(filtered);
}

document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.dataset.filter;
    filterProducts();
  });
});

// CART
function addToCart(id, e) {
  if(e) e.stopPropagation();
  const p = allProducts.find(x => (x._id||x.id) == id);
  if (!p) return;
  const ex = cart.find(c => (c._id||c.id) == id);
  if (ex) ex.qty++;
  else cart.push({...p, qty:1});
  updateCartCount();
  showToast('üõí ' + p.name + ' added!');
}
function updateCartCount(){
  document.getElementById('cartCount').textContent = cart.reduce((s,c)=>s+c.qty,0);
}
function openCart(){
  document.getElementById('cartOverlay').classList.add('open');
  renderCart();
}
function closeCart(){
  document.getElementById('cartOverlay').classList.remove('open');
}
function renderCart(){
  const body = document.getElementById('cartBody');
  const ft   = document.getElementById('cartFt');
  if(!cart.length){
    body.innerHTML = `<div class="cart-empty"><div class="ei">üõí</div><p style="font-weight:700;font-size:16px">Your cart is empty!<br>Add some toys to get started.</p></div>`;
    ft.style.display='none'; return;
  }
  ft.style.display='block';
  body.innerHTML = cart.map(item => {
    const thumbHTML = item.img
      ? `<div class="cart-thumb"><img src="${item.img.startsWith('http')?item.img:API+item.img}" alt="${item.name}"></div>`
      : `<div class="cart-thumb">${item.emoji}</div>`;
    return `<div class="cart-item">
      ${thumbHTML}
      <div class="cart-info">
        <div class="cart-name">${item.name}</div>
        <div class="cart-price">‚Çπ${item.price} √ó ${item.qty} = ‚Çπ${item.price*item.qty}</div>
      </div>
      <div class="qty-ctrl">
        <button class="qty-btn" onclick="changeQty('${item._id||item.id}',-1)">‚àí</button>
        <span style="font-weight:900;font-size:15px">${item.qty}</span>
        <button class="qty-btn" onclick="changeQty('${item._id||item.id}',1)">+</button>
      </div>
    </div>`;
  }).join('');
  document.getElementById('cartTotal').textContent = '‚Çπ' + cart.reduce((s,c)=>s+c.price*c.qty,0);
}
function changeQty(id,delta){
  const item = cart.find(c=>(c._id||c.id)==id);
  if(!item) return;
  item.qty += delta;
  if(item.qty<=0) cart = cart.filter(c=>(c._id||c.id)!=id);
  updateCartCount(); renderCart();
}

// ORDER FORM
function openOrderForm(){
  closeCart();
  document.getElementById('orderOverlay').classList.add('open');
}
function closeOrderForm(){
  document.getElementById('orderOverlay').classList.remove('open');
}

async function submitOrder(){
  const name  = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  const addr  = document.getElementById('custAddr').value.trim();
  const pay   = document.getElementById('payMode').value;
  const notes = document.getElementById('custNotes').value.trim();
  if(!name || !phone){ showToast('‚ö†Ô∏è Name and phone required!'); return; }
  if(!/^[0-9]{10}$/.test(phone)){ showToast('‚ö†Ô∏è Enter valid 10-digit phone!'); return; }

  const items = cart.map(c=>({ product:c._id||c.id, name:c.name, price:c.price, qty:c.qty, img:c.img||'', emoji:c.emoji||'üß∏' }));
  const total = cart.reduce((s,c)=>s+c.price*c.qty,0);

  // Save to backend
  try {
    await fetch(API+'/api/orders', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ customerName:name, phone, address:addr, items, total, paymentMode:pay, notes })
    });
  } catch(e) {}

  // WhatsApp message
  let msg = `üß∏ *New Order - ARS TOYS*\n\n`;
  msg += `üë§ *Name:* ${name}\nüì± *Phone:* ${phone}\n`;
  if(addr) msg += `üìç *Address:* ${addr}\n`;
  msg += `üí≥ *Payment:* ${pay.toUpperCase()}\n\n`;
  msg += `*üõí Order Items:*\n`;
  cart.forEach((c,i) => { msg += `${i+1}. ${c.emoji} ${c.name} √ó ${c.qty} = ‚Çπ${c.price*c.qty}\n`; });
  msg += `\nüí∞ *Total: ‚Çπ${total}*\n`;
  if(notes) msg += `\nüìù *Notes:* ${notes}`;
  msg += `\n\nPlease confirm my order! üòä`;

  window.open(`https://wa.me/${waNumber}?text=${encodeURIComponent(msg)}`, '_blank');
  cart = [];
  updateCartCount();
  closeOrderForm();
  showToast('‚úÖ Order sent to WhatsApp!');
}

function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2500);
}

loadConfig();
fetchProducts();
</script>
</body>
</html>
